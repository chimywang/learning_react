{"version":3,"sources":["../../source/plugin/write assets.js"],"names":[],"mappings":"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","file":"write assets.js","sourcesContent":["import fs     from 'fs-extra'\nimport path   from 'path'\nimport require_hacker from 'require-hacker'\nimport serialize      from '../tools/serialize-javascript'\n\nimport { exists, clone, replace_all, starts_with, last } from '../helpers'\nimport { alias_hook, uniform_path } from '../common'\n\n// writes webpack-assets.json file, which contains assets' file paths\nexport default function write_assets(json, options, log)\n{\n\t// take the passed in options\n\toptions = clone(options)\n\n\tlog.debug(`running write assets webpack plugin v${require('../../package.json').version} with options`, options)\n\n\t// make webpack stats accessible for asset functions (parser, path, filter)\n\toptions.webpack_stats = json\n\n\tconst development = options.development\n\n\tif (development)\n\t{\n\t\tlog.debug(' (development mode is on)')\n\t}\n\n\t// write webpack stats json for debugging purpose\n\tif (options.debug)\n\t{\n\t\t// write webpack stats file\n\t\tlog.debug(`writing webpack stats to ${options.webpack_stats_path}`)\n\n\t\t// write the file\n\t\t// (format the JSON for better readability)\n\t\tfs.outputFileSync(options.webpack_stats_path, JSON.stringify(json, null, 2))\n\t}\n\n\t// the output object with assets\n\tconst output = options.output\n\n\t// populate the output object with assets\n\tpopulate_assets(output, json, options, log)\n\n\t// write webpack assets info file\n\tif (options.output_to_a_file)\n\t{\n\t\t// format the JSON for better readability if in debug mode\n\t\tconst assets_info = development ? JSON.stringify(output, null, 2) : JSON.stringify(output)\n\n\t\t// rewrite `webpack-assets.json`\n\t\tlet rewrite = true\n\n\t\t// for `webpack-assets.json` caching to work\n\t\t// chunks info should be moved out of it,\n\t\t// otherwise chunk hashsums constantly change,\n\t\t// and there won't be any caching.\n\t\t//\n\t\t// const assets_buffer = Buffer.from(assets_info)\n\t\t//\n\t\t// // if webpack-assets.json already exists,\n\t\t// // then maybe no need to rewrite it\n\t\t// if (fs.existsSync(options.webpack_assets_path))\n\t\t// {\n\t\t// \t// previously written webpack-assets.json\n\t\t// \tconst previous_assets_buffer = fs.readFileSync(options.webpack_assets_path)\n\t\t//\n\t\t// \t// if webpack-assets.json rewrite is not needed, then don't do it\n\t\t// \tif (assets_buffer.equals(previous_assets_buffer))\n\t\t// \t{\n\t\t// \t\trewrite = false\n\t\t// \t}\n\t\t// }\n\n\t\t// if webpack-assets.json rewrite is needed, then do it\n\t\tif (rewrite)\n\t\t{\n\t\t\tlog.debug(`writing webpack assets info to ${options.webpack_assets_path}`)\n\t\t\t// write the file\n\t\t\tfs.outputFileSync(options.webpack_assets_path, assets_info)\n\t\t}\n\t}\n\telse\n\t{\n\t\tlog.debug(`serving webpack assets from memory`)\n\t}\n\n\t// return Webpack assets JSON object\n\t// for serving it through HTTP service\n\treturn output\n}\n\n// populates the output object with assets\nfunction populate_assets(output, json, options, log)\n{\n\t// for each chunk name (\"main\", \"common\", ...)\n\tObject.keys(json.assetsByChunkName).forEach(function(name)\n\t{\n\t\tlog.debug(`getting javascript and styles for chunk \"${name}\"`)\n\n\t\t// get javascript chunk real file path\n\n\t\tconst javascript = get_assets(name, 'js')[0]\n\t\t// the second asset is usually a source map\n\n\t\tif (javascript)\n\t\t{\n\t\t\tlog.debug(` (got javascript)`)\n\t\t\toutput.javascript[name] = javascript\n\t\t}\n\n\t\t// get style chunk real file path\n\n\t\tconst style = get_assets(name, 'css')[0]\n\t\t// the second asset is usually a source map\n\n\t\tif (style)\n\t\t{\n\t\t\tlog.debug(` (got style)`)\n\t\t\toutput.styles[name] = style\n\t\t}\n\t})\n\n\t// gets asset paths by name and extension of their chunk\n\tfunction get_assets(name, extension = 'js')\n\t{\n\t\tlet chunk = json.assetsByChunkName[name]\n\n\t\t// a chunk could be a string or an array, so make sure it is an array\n\t\tif (!(Array.isArray(chunk)))\n\t\t{\n\t\t\tchunk = [chunk]\n\t\t}\n\n\t\treturn chunk\n\t\t\t// filter by extension\n\t\t\t.filter(name => path.extname(extract_path(name)) === `.${extension}`)\n\t\t\t// adjust the real path (can be http, filesystem)\n\t\t\t.map(name => options.assets_base_url + name)\n\t}\n\n\t// one can supply a custom filter\n\tconst default_filter = (module, regular_expression) => regular_expression.test(module.name)\n\t// one can supply a custom namer\n\tconst default_asset_path = module => module.name\n\t// one can supply a custom parser\n\tconst default_parser = module => module.source\n\n\t// 1st pass\n\tconst parsed_assets = {}\n\n\t// global paths to parsed asset paths\n\tconst global_paths_to_parsed_asset_paths = {}\n\n\t// define __webpack_public_path__ webpack variable\n\t// (resolves \"ReferenceError: __webpack_public_path__ is not defined\")\n\tconst define_webpack_public_path = 'var __webpack_public_path__ = ' + JSON.stringify(options.assets_base_url) + ';\\n'\n\n\t// for each user specified asset type\n\tfor (let asset_type of Object.keys(options.assets))\n\t{\n\t\t// asset type settings\n\t\tconst asset_type_settings = options.assets[asset_type]\n\n\t\t// one can supply his own filter\n\t\tconst filter = (asset_type_settings.filter || default_filter) //.bind(this)\n\t\t// one can supply his own path parser\n\t\tconst extract_asset_path = (asset_type_settings.path || default_asset_path) //.bind(this)\n\t\t// one can supply his own parser\n\t\tconst parser = (asset_type_settings.parser || default_parser) //.bind(this)\n\n\t\t// guard agains typos, etc\n\n\t\t// for filter\n\t\tif (!asset_type_settings.filter)\n\t\t{\n\t\t\tlog.debug(`No filter specified for \"${asset_type}\" assets. Using a default one.`)\n\t\t}\n\n\t\t// for path parser\n\t\tif (!asset_type_settings.path)\n\t\t{\n\t\t\tlog.debug(`No path parser specified for \"${asset_type}\" assets. Using a default one.`)\n\t\t}\n\n\t\t// for parser\n\t\tif (!asset_type_settings.parser)\n\t\t{\n\t\t\tlog.debug(`No parser specified for \"${asset_type}\" assets. Using a default one.`)\n\t\t}\n\n\t\tlog.debug(`parsing assets of type \"${asset_type}\"`)\n\n\t\t// timer start\n\t\tconst began_at = new Date().getTime()\n\n\t\t// get real paths for all the files from this asset type\n\t\tjson.modules\n\t\t\t// take just modules of this asset type\n\t\t\t.filter(module =>\n\t\t\t{\n\t\t\t\t// check that this asset is of the asset type\n\t\t\t\tif (!filter(module, options.regular_expressions[asset_type], options, log))\n\t\t\t\t{\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\t// guard against an empty source.\n\t\t\t\tif (!module.source)\n\t\t\t\t{\n\t\t\t\t\tlog.error(`Module \"${module.name}\" has no source. Maybe Webpack compilation of this module failed. Skipping this asset.`)\n\t\t\t\t\treturn false\n\t\t\t\t}\n\n\t\t\t\t// include this asset\n\t\t\t\treturn true\n\t\t\t})\n\t\t\t.reduce((set, module) =>\n\t\t\t{\n\t\t\t\t// determine asset real path\n\t\t\t\tconst asset_path = extract_asset_path(module, options, log)\n\n\t\t\t\t// asset module source, or asset content (or whatever else)\n\t\t\t\tconst parsed_asset = parser(module, options, log)\n\n\t\t\t\tlog.trace(`Adding asset \"${asset_path}\", module id ${module.id} (in webpack-stats.json)`)\n\n\t\t\t\t// check for naming collisions (just in case)\n\t\t\t\tif (exists(set[asset_path]))\n\t\t\t\t{\n\t\t\t\t\tlog.error('-----------------------------------------------------------------')\n\t\t\t\t\tlog.error(`Asset with path \"${asset_path}\" was overwritten because of path collision.`)\n\t\t\t\t\tlog.error(`Use the \"filter\" function of this asset type to narrow the results.`)\n\t\t\t\t\tlog.error(`Previous asset with this path:`)\n\t\t\t\t\tlog.error(set[asset_path])\n\t\t\t\t\tlog.error(`New asset with this path:`)\n\t\t\t\t\tlog.error(parsed_asset)\n\t\t\t\t\tlog.error('-----------------------------------------------------------------')\n\t\t\t\t}\n\n\t\t\t\t// add this asset to the list\n\t\t\t\t//\n\t\t\t\t// also resolve \"ReferenceError: __webpack_public_path__ is not defined\".\n\t\t\t\t// because it may be a url-loaded resource (e.g. a font inside a style).\n\t\t\t\tset[asset_path] = define_webpack_public_path + require_hacker.to_javascript_module_source(parsed_asset)\n\n\t\t\t\t// add path mapping\n\t\t\t\tglobal_paths_to_parsed_asset_paths[path.resolve(options.project_path, asset_path)] = asset_path\n\n\t\t\t\t// continue\n\t\t\t\treturn set\n\t\t\t},\n\t\t\tparsed_assets)\n\n\t\t// timer stop\n\t\tlog.debug(` time taken: ${new Date().getTime() - began_at} ms`)\n\t}\n\n\t// register a special require() hook for requiring() raw webpack modules\n\tconst require_hook = require_hacker.global_hook('webpack-module', (required_path, module) =>\n\t{\n\t\tlog.debug(`require()ing \"${required_path}\"`)\n\n\t\t// if Webpack aliases are supplied\n\t\tif (options.alias)\n\t\t{\n\t\t\t// possibly alias the path\n\t\t\tconst aliased_global_path = alias_hook(required_path, module, options.project_path, options.alias, log)\n\n\t\t\t// if an alias is found\n\t\t\tif (aliased_global_path)\n\t\t\t{\n\t\t\t\treturn require_hacker.to_javascript_module_source(safe_require(aliased_global_path, log))\n\t\t\t}\n\t\t}\n\n\t\t// find an asset with this path\n\t\t//\n\t\t// the require()d path will be global path in case of the for..of require() loop\n\t\t// for the assets (the code a couple of screens below).\n\t\t//\n\t\t// (it can be anything in other cases (e.g. nested require() calls from the assets))\n\t\t//\n\t\tif (exists(global_paths_to_parsed_asset_paths[required_path]))\n\t\t{\n\t\t\tlog.debug(` found in parsed assets`)\n\t\t\treturn parsed_assets[global_paths_to_parsed_asset_paths[required_path]]\n\t\t}\n\n\t\tlog.debug(` not found in parsed assets, searching in webpack stats`)\n\n\t\t// find a webpack module which has a reason with this path\n\n\t\tconst candidates = []\n\n\t\tfor (let module of json.modules)\n\t\t{\n\t\t\tfor (let reason of module.reasons)\n\t\t\t{\n\t\t\t\tif (reason.userRequest === required_path)\n\t\t\t\t{\n\t\t\t\t\tcandidates.push(module)\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// guard against ambiguity\n\n\t\tif (candidates.length === 1)\n\t\t{\n\t\t\tlog.debug(` found in webpack stats, module id ${candidates[0].id}`)\n\n\t\t\t// also resolve \"ReferenceError: __webpack_public_path__ is not defined\".\n\t\t\t// because it may be a url-loaded resource (e.g. a font inside a style).\n\t\t\treturn define_webpack_public_path + candidates[0].source\n\t\t}\n\n\t\t// if there are more than one candidate for this require()d path,\n\t\t// then try to guess which one is the one require()d\n\n\t\tif (candidates.length > 1)\n\t\t{\n\t\t\tlog.debug(` More than a single candidate module was found in webpack stats for require()d path \"${required_path}\"`)\n\n\t\t\tfor (let candidate of candidates)\n\t\t\t{\n\t\t\t\tlog.debug(' ', candidate)\n\t\t\t}\n\n\t\t\t// (loaders matter so the program can't simply throw them away from the required path)\n\t\t\t//\n\t\t\t// // tries to normalize a cryptic Webpack loader path\n\t\t\t// // into a regular relative file path\n\t\t\t// // https://webpack.github.io/docs/loaders.html\n\t\t\t// let filesystem_required_path = last(required_path\n\t\t\t// \t.replace(/^!!/, '')\n\t\t\t// \t.replace(/^!/, '')\n\t\t\t// \t.replace(/^-!/, '')\n\t\t\t// \t.split('!'))\n\n\t\t\tconst fail = () =>\n\t\t\t{\n\t\t\t\tthrow new Error(`More than a single candidate module was found in webpack stats for require()d path \"${required_path}\". Enable \"debug: true\" flag in webpack-isomorphic-tools configuration for more info.`)\n\t\t\t}\n\n\t\t\t// https://webpack.github.io/docs/loaders.html\n\t\t\tconst is_webpack_loader_path = required_path.indexOf('!') >= 0\n\n\t\t\t// if it's a Webpack loader-powered path, the code gives up\n\t\t\tif (is_webpack_loader_path)\n\t\t\t{\n\t\t\t\tfail()\n\t\t\t}\n\n\t\t\t// from here on it's either a filesystem path or an npm module path\n\n\t\t\tconst is_a_global_path = path => starts_with(path, '/') || path.indexOf(':') > 0\n\t\t\tconst is_a_relative_path = path => starts_with(path, './') || starts_with(path, '../')\n\n\t\t\tconst is_relative_path = is_a_relative_path(required_path)\n\t\t\tconst is_global_path = is_a_global_path(required_path)\n\t\t\tconst is_npm_module_path = !is_relative_path && !is_global_path\n\n\t\t\t// if it's a global path it can be resolved right away\n\t\t\tif (is_global_path)\n\t\t\t{\n\t\t\t\treturn require_hacker.to_javascript_module_source(safe_require(required_path, log))\n\t\t\t}\n\n\t\t\t// from here on it's either a relative filesystem path or an npm module path,\n\t\t\t// so it can be resolved against the require()ing file path (if it can be recovered).\n\n\t\t\t// `module.filename` here can be anything, not just a filesystem absolute path,\n\t\t\t// since some advanced require() hook trickery is involved.\n\t\t\t// therefore it will be parsed.\n\t\t\t//\n\t\t\tlet requiring_file_path = module.filename.replace(/\\.webpack-module$/, '')\n\n\t\t\t// if it's a webpack loader-powered path, then extract the filesystem path from it\n\t\t\tif (requiring_file_path.indexOf('!') >= 0)\n\t\t\t{\n\t\t\t\trequiring_file_path = requiring_file_path.substring(requiring_file_path.lastIndexOf('!') + 1)\n\t\t\t}\n\n\t\t\t// make relative path global\n\t\t\tif (is_a_relative_path(requiring_file_path))\n\t\t\t{\n\t\t\t\trequiring_file_path = path.resolve(options.project_path, requiring_file_path)\n\t\t\t}\n\n\t\t\t// if `requiring_file_path` is a filesystem path (not an npm module path),\n\t\t\t// then the require()d path can possibly be resolved\n\t\t\tif (is_a_global_path(requiring_file_path))\n\t\t\t{\n\t\t\t\tlog.debug(` The module is being require()d from \"${requiring_file_path}\", so resolving the path against this file`)\n\n\t\t\t\t// if it's a relative path, can try to resolve it\n\t\t\t\tif (is_relative_path)\n\t\t\t\t{\n\t\t\t\t\treturn require_hacker.to_javascript_module_source(safe_require(path.resolve(requiring_file_path, '..', required_path), log))\n\t\t\t\t}\n\n\t\t\t\t// if it's an npm module path (e.g. 'babel-runtime/core-js/object/assign'),\n\t\t\t\t// can try to require() it from the requiring asset path\n\t\t\t\tif (is_npm_module_path && is_a_global_path(module.filename))\n\t\t\t\t{\n\t\t\t\t\treturn require_hacker.to_javascript_module_source(safe_require(require_hacker.resolve(required_path, module), log))\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// if it's still here then it means it's either a\n\t\t\tfail()\n\t\t}\n\t})\n\n\tlog.debug(`compiling assets`)\n\n\t// timer start\n\tconst began_at = new Date().getTime()\n\n\t// evaluate parsed assets source code\n\tfor (let asset_path of Object.keys(parsed_assets))\n\t{\n\t\t// set asset value\n\t\tlog.debug(`compiling asset \"${asset_path}\"`)\n\t\toutput.assets[asset_path] = safe_require(path.resolve(options.project_path, asset_path), log)\n\n\t\t// inside that require() call above\n\t\t// all the assets are resolved relative to this `module`,\n\t\t// which is irrelevant because they are all absolute filesystem paths.\n\t\t//\n\t\t// if in some of those assets a nested require() call is present\n\t\t// then it will be resolved relative to that asset folder.\n\t}\n\n\t// unmount the previously installed require() hook\n\trequire_hook.unmount()\n\n\t// timer stop\n\tlog.debug(` time taken: ${new Date().getTime() - began_at} ms`)\n}\n\nfunction safe_require(path, log)\n{\n\ttry\n\t{\n\t\treturn require(path)\n\t}\n\tcatch (error)\n\t{\n\t\tlog.error(error)\n\t\treturn undefined\n\t}\n}\n\nexport function extract_path(from)\n{\n  const question_mark_index = from.indexOf('?')\n  if (question_mark_index === -1)\n  {\n    return from\n  }\n  return from.slice(0, question_mark_index)\n}\n"]}